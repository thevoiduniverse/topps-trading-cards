generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "sqlite"
}

// Individual card in inventory - each row is a unique physical card
model Card {
  id              String      @id @default(uuid())

  // Player/Subject info
  playerName      String
  team            String
  sport           String      @default("Football") // Football, Baseball, Basketball, etc.

  // Card set info
  year            Int         // e.g., 2024, 2025
  setName         String      // e.g., "Topps Chrome", "Topps Finest", "Bowman Chrome"
  cardNumber      String?     // Card number in the set (e.g., "RC-1", "150")

  // Images - front and back
  frontImageUrl   String?
  backImageUrl    String?

  // Parallel/Variant info (Topps system)
  parallelType    String      @default("BASE") // BASE, REFRACTOR, PRISM_REFRACTOR, XFRACTOR, etc.
  colorVariant    String?     // Blue, Green, Gold, Orange, Black, Red, Purple, Pink, etc.

  // Numbered cards
  isNumbered      Boolean     @default(false)
  printRun        Int?        // Total print run (e.g., 99, 50, 25, 10, 5, 1)
  serialNumber    Int?        // This card's number (e.g., 45 of 99)

  // Special designations
  isRookie        Boolean     @default(false)
  isAutograph     Boolean     @default(false)
  isRelic         Boolean     @default(false) // Memorabilia card
  isShortPrint    Boolean     @default(false)
  isVariation     Boolean     @default(false) // Photo variation

  // Condition
  condition       String      @default("NEAR_MINT") // MINT, NEAR_MINT, EXCELLENT, GOOD, FAIR, POOR
  conditionNotes  String?

  // Pricing and status
  price           Float
  status          String      @default("AVAILABLE") // AVAILABLE, RESERVED, SOLD

  // Timestamps
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  // Relations
  cartItems       CartItem[]
  orderItems      OrderItem[]

  @@index([status])
  @@index([parallelType])
  @@index([team])
  @@index([playerName])
  @@index([setName])
  @@index([year])
  @@index([isNumbered])
}

// Shopping cart
model Cart {
  id          String      @id @default(uuid())
  sessionId   String      @unique

  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  expiresAt   DateTime

  items       CartItem[]
}

model CartItem {
  id        String    @id @default(uuid())

  cartId    String
  cart      Cart      @relation(fields: [cartId], references: [id], onDelete: Cascade)

  cardId    String
  card      Card      @relation(fields: [cardId], references: [id])

  addedAt   DateTime  @default(now())

  @@unique([cartId, cardId])
}

// Orders for direct card purchases
model Order {
  id              String      @id @default(uuid())

  buyerEmail      String
  buyerName       String?
  shippingAddress String?

  stripePaymentId String?
  totalAmount     Float
  status          String      @default("PENDING") // PENDING, PAID, SHIPPED, DELIVERED, CANCELLED

  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  items           OrderItem[]
}

model OrderItem {
  id          String    @id @default(uuid())

  orderId     String
  order       Order     @relation(fields: [orderId], references: [id])

  cardId      String
  card        Card      @relation(fields: [cardId], references: [id])

  pricePaid   Float

  createdAt   DateTime  @default(now())

  @@unique([orderId, cardId])
}
